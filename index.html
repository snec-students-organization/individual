<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Competition Results</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <style>
    body { 
      padding: 20px; 
      background: linear-gradient(135deg, #e0eafc, #cfdef3);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 1rem;
      min-height: 100vh;
      padding-top: 70px; /* Adjust for fixed navbar height */
    }
    .container { 
      padding-bottom: 80px; 
      max-width: 1200px;
    }
    .navbar {
      background-color: #2c3e50;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
    }
    .navbar-brand img {
      max-height: 40px;
      object-fit: contain;
    }
    .navbar-nav .nav-link {
      color: #ffffff !important;
      font-weight: 500;
      transition: color 0.3s ease;
    }
    .navbar-nav .nav-link:hover {
      color: #ffc107 !important;
    }
    .navbar-toggler {
      border-color: #ffffff;
    }
    .header-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .logo {
      max-height: 60px;
      transition: transform 0.3s ease;
      object-fit: contain;
    }
    .logo:hover {
      transform: scale(1.1);
    }
    .header-title {
      color: #2c3e50;
      font-size: 2rem;
      margin: 0;
      flex-grow: 1;
      text-align: center;
    }
    .form-section { 
      margin-bottom: 30px; 
      padding: 20px; 
      background-color: white; 
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      transition: all 0.3s ease;
    }
    .form-section:hover {
      transform: translateY(-3px);
    }
    .results-container { 
      margin-top: 30px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
    }
    #adminSection { display: none; }
    .result-card {
      background: white;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .result-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 20px rgba(0,0,0,0.15);
    }
    .result-card .header {
      border-bottom: 2px solid #f1f1f1;
      padding-bottom: 10px;
      margin-bottom: 10px;
    }
    .result-card .header h3 {
      color: #2c3e50;
      margin-bottom: 5px;
      font-size: 1.2rem;
    }
    .result-card .header .stream-cat {
      color: #7f8c8d;
      font-size: 0.8rem;
    }
    .winner {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 8px;
    }
    .winner.first-place {
      background: linear-gradient(135deg, #fff9e6, #ffecb3);
      border-left: 4px solid #ffc107;
      animation: pulse 2s infinite;
    }
    .winner.second-place {
      background-color: #f8f9fa;
      border-left: 4px solid #6c757d;
    }
    .winner.third-place {
      background-color: #f8f9fa;
      border-left: 4px solid #fd7e14;
    }
    .winner .position {
      font-weight: bold;
      margin-right: 10px;
      width: 30px;
      text-align: center;
      font-size: 1rem;
    }
    .winner.first-place .position {
      color: #ffc107;
      font-size: 1.2rem;
    }
    .winner.second-place .position {
      color: #6c757d;
    }
    .winner.third-place .position {
      color: #fd7e14;
    }
    .winner .details {
      flex-grow: 1;
    }
    .winner .name {
      font-weight: 600;
      margin-bottom: 3px;
      font-size: 0.9rem;
    }
    .winner .college, .winner .uid, .winner .grade {
      color: #7f8c8d;
      font-size: 0.75rem;
    }
    .congrats-banner {
      position: absolute;
      top: 10px;
      right: -50px;
      background: #ffc107;
      color: white;
      padding: 5px 50px;
      transform: rotate(45deg);
      font-weight: bold;
      font-size: 0.7rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      animation: bounceIn 1s;
    }
    .category-field {
      display: none;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    .trophy-icon {
      color: #ffc107;
      margin-right: 5px;
    }
    .file-upload {
      margin-bottom: 15px;
    }
    .winner-input-group {
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 15px;
      background-color: #f8f9fa;
    }
    .winner-input-group .btn-group {
      margin-top: 10px;
    }
    .btn-plus, .btn-minus {
      margin-right: 5px;
      padding: 8px 12px;
      font-size: 0.9rem;
    }
    #updateExcelSection {
      display: none;
      margin-top: 20px;
      padding: 15px;
      background-color: #e9ecef;
      border-radius: 8px;
    }
    .entry-type-section {
      margin-bottom: 15px;
    }
    .form-check {
      padding-left: 2rem;
      margin-bottom: 10px;
    }
    .form-check-input {
      margin-left: -2rem;
      width: 1.25rem;
      height: 1.25rem;
    }
    .form-check-label {
      font-size: 1rem;
      margin-left: 10px;
    }
    .admin-results-section {
      margin-top: 30px;
      padding: 20px;
      background-color: #f8f9fa;
      border-radius: 10px;
    }
    .admin-results-section h3 {
      color: #2c3e50;
      margin-bottom: 20px;
    }
    .stream-group {
      margin-bottom: 20px;
    }
    .stream-group h4 {
      color: #34495e;
      margin-bottom: 15px;
    }
    .admin-result-item {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      position: relative;
    }
    .admin-result-item .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .admin-result-item .status-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .admin-result-item .delete-button-container {
      margin-top: 15px;
      text-align: right;
    }
    .search-container {
      margin-bottom: 20px;
    }
    @media (max-width: 576px) {
      body { 
        padding: 10px; 
        font-size: 0.85rem; 
        padding-top: 60px; /* Adjust for fixed navbar on mobile */
      }
      .container { 
        padding-bottom: 70px; 
      }
      .navbar-brand img {
        max-height: 30px;
      }
      .navbar-nav .nav-link {
        font-size: 0.9rem;
      }
      .header-section {
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }
      .logo {
        max-height: 40px;
        margin: 5px 0;
        width: 80px;
      }
      .header-title {
        font-size: 1.5rem;
        margin: 10px 0;
      }
      .form-section { 
        padding: 12px; 
        border-radius: 10px;
      }
      .result-card { 
        padding: 10px; 
      }
      .result-card .header h3 { 
        font-size: 1rem; 
      }
      .winner .position { 
        font-size: 0.85rem; 
        width: 25px;
      }
      .winner .name { 
        font-size: 0.8rem; 
      }
      .winner .college, .winner .uid, .winner .grade { 
        font-size: 0.65rem; 
      }
      .btn { 
        padding: 8px; 
        font-size: 0.85rem; 
      }
      .form-control, .form-select { 
        font-size: 0.85rem; 
        padding: 8px; 
      }
      .form-check-label { 
        font-size: 0.85rem; 
      }
      .results-container {
        grid-template-columns: 1fr;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <img src="image\SHAREE'A (1).png" alt="Competition Logo">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="#resultsContainer">View Results</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#adminModal">Admin Section</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <div class="header-section animate__animated animate__fadeInDown">
      <img style="width: 115px;height: 64px;" src="image\sa_pho-removebg-preview.png" alt="Shareea Logo" class="logo">
      <h1 class="header-title">Competition Results System</h1>
    </div>

    <!-- User View Section -->
    <section class="form-section animate__animated animate__fadeIn">
      <h2>View Results</h2>
      <div class="row g-3">
        <div class="col-md-4 col-12">
          <label for="fStream" class="form-label">Stream:</label>
          <select class="form-select" id="fStream">
            <option value="" selected>-- All Streams --</option>
            <option value="Shareea">Shareea</option>
            <option value="Shareea Plus">Shareea Plus</option>
            <option value="Life">Life</option>
            <option value="SHE">SHE</option>
            <option value="SHE Plus">SHE Plus</option>
          </select>
        </div>
        <div class="col-md-4 col-12">
          <label for="fCategory" class="form-label">Category:</label>
          <select class="form-select" id="fCategory">
            <option value="" selected>-- All Categories --</option>
            <option value="Sanaviyya">Sanaviyya</option>
            <option value="Bakalooriyya">Bakalooriyya</option>
            <option value="PG">PG</option>
            <option value="General">General</option>
          </select>
        </div>
        <div class="col-md-4 col-12">
          <label for="fCompItem" class="form-label">Competition Item:</label>
          <select class="form-select" id="fCompItem">
            <option value="" selected>-- All Items --</option>
          </select>
        </div>
        <div class="col-12">
          <button type="button" class="btn btn-primary animate__animated animate__pulse animate__infinite" onclick="filterResults()">View Results</button>
          <button type="button" class="btn btn-secondary ms-2" onclick="resetFilters()">Reset Filters</button>
        </div>
      </div>

      <div class="results-container mt-4" id="resultsContainer"></div>
      <div class="alert alert-warning mt-3" id="noResultsAlert" style="display:none;">
        No results found matching your criteria.
      </div>
    </section>

    <!-- Admin Upload Section -->
    <section class="form-section" id="adminSection">
      <h2>Upload Result</h2>
      <form id="resultForm">
        <div class="row g-3">
          <div class="col-12 file-upload">
            <label for="excelFiles" class="form-label">Upload Excel File(s) (College, UID, Name):</label>
            <input type="file" class="form-control" id="excelFiles" accept=".xlsx, .xls" multiple>
            <small class="form-text text-muted">Upload one or two Excel files with College in Column A, UID in Column C, and Name in Column D. Enter "NIL" for no student.</small>
          </div>
          <div class="col-md-4 col-12">
            <label for="compItem" class="form-label">Competition Item:</label>
            <input type="text" class="form-control" id="compItem" required placeholder="Enter competition name">
          </div>
          <div class="col-md-4 col-12">
            <label for="stream" class="form-label">Stream:</label>
            <select class="form-select" id="stream" required onchange="toggleCategoryField()">
              <option value="" selected disabled>-- Select Stream --</option>
              <option value="Shareea">Shareea</option>
              <option value="Shareea Plus">Shareea Plus</option>
              <option value="Life">Life</option>
              <option value="SHE">SHE</option>
              <option value="SHE Plus">SHE Plus</option>
            </select>
          </div>
          <div class="col-md-4 col-12 category-field" id="categoryField">
            <label for="category" class="form-label">Category:</label>
            <select class="form-select" id="category">
              <option value="" selected disabled>-- Select Category --</option>
              <option value="Sanaviyya">Sanaviyya</option>
              <option value="Bakalooriyya">Bakalooriyya</option>
              <option value="PG">PG</option>
              <option value="General">General</option>
            </select>
          </div>
          <div class="col-12 entry-type-section">
            <label class="form-label">Entry Type:</label>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="entryType" id="entryIndividual" value="individual" checked>
              <label class="form-check-label" for="entryIndividual">Individual</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="entryType" id="entryGroup" value="group">
              <label class="form-check-label" for="entryGroup">Group (Max 7 members per group)</label>
            </div>
          </div>
          <div class="col-md-4 col-12">
            <div id="firstPlaceGroup" class="winner-input-group">
              <h5 id="firstPlaceLabel">First Place</h5>
              <div class="winner-input" data-index="0">
                <label class="form-label">UID:</label>
                <input type="text" class="form-control uid-input" data-position="first" data-index="0" placeholder="Enter UID or NIL">
                <div class="invalid-feedback"></div>
                <label class="form-label mt-2">Name:</label>
                <input type="text" class="form-control name-input" data-position="first" data-index="0" readonly>
                <label class="form-label mt-2">College:</label>
                <input type="text" class="form-control college-input" data-position="first" data-index="0" readonly>
                <label class="form-label mt-2">Grade:</label>
                <select class="form-select grade-input" data-position="first" data-index="0">
                  <option value="" selected disabled>-- Select Grade --</option>
                  <option value="No Grade">No Grade</option>
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="C">C</option>
                </select>
              </div>
              <div class="btn-group">
                <button type="button" class="btn btn-sm btn-success btn-plus" data-position="first">+ Add Winner</button>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-12">
            <div id="secondPlaceGroup" class="winner-input-group">
              <h5 id="secondPlaceLabel">Second Place</h5>
              <div class="winner-input" data-index="0">
                <label class="form-label">UID:</label>
                <input type="text" class="form-control uid-input" data-position="second" data-index="0" placeholder="Enter UID or NIL">
                <div class="invalid-feedback"></div>
                <label class="form-label mt-2">Name:</label>
                <input type="text" class="form-control name-input" data-position="second" data-index="0" readonly>
                <label class="form-label mt-2">College:</label>
                <input type="text" class="form-control college-input" data-position="second" data-index="0" readonly>
                <label class="form-label mt-2">Grade:</label>
                <select class="form-select grade-input" data-position="second" data-index="0">
                  <option value="" selected disabled>-- Select Grade --</option>
                  <option value="No Grade">No Grade</option>
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="C">C</option>
                </select>
              </div>
              <div class="btn-group">
                <button type="button" class="btn btn-sm btn-success btn-plus" data-position="second">+ Add Winner</button>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-12">
            <div id="thirdPlaceGroup" class="winner-input-group">
              <h5 id="thirdPlaceLabel">Third Place</h5>
              <div class="winner-input" data-index="0">
                <label class="form-label">UID:</label>
                <input type="text" class="form-control uid-input" data-position="third" data-index="0" placeholder="Enter UID or NIL">
                <div class="invalid-feedback"></div>
                <label class="form-label mt-2">Name:</label>
                <input type="text" class="form-control name-input" data-position="third" data-index="0" readonly>
                <label class="form-label mt-2">College:</label>
                <input type="text" class="form-control college-input" data-position="third" data-index="0" readonly>
                <label class="form-label mt-2">Grade:</label>
                <select class="form-select grade-input" data-position="third" data-index="0">
                  <option value="" selected disabled>-- Select Grade --</option>
                  <option value="No Grade">No Grade</option>
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="C">C</option>
                </select>
              </div>
              <div class="btn-group">
                <button type="button" class="btn btn-sm btn-success btn-plus" data-position="third">+ Add Winner</button>
              </div>
            </div>
          </div>
          <div class="col-12" id="updateExcelSection">
            <h5>Update Excel Files</h5>
            <div class="row g-3">
              <div class="col-md-6 col-12">
                <label for="excelUpdatePin" class="form-label">Enter PIN to Update Excel Files:</label>
                <input type="password" class="form-control" id="excelUpdatePin" maxlength="8" placeholder="Enter PIN">
                <div class="invalid-feedback" id="excelPinError"></div>
              </div>
              <div class="col-md-6 col-12">
                <label for="newExcelFiles" class="form-label">Upload New Excel File(s):</label>
                <input type="file" class="form-control" id="newExcelFiles" accept=".xlsx, .xls" multiple>
              </div>
              <div class="col-12">
                <button type="button" class="btn btn-primary" onclick="updateExcelFiles()">Update Excel Files</button>
              </div>
            </div>
          </div>
          <div class="col-12 mt-3">
            <button type="button" class="btn btn-success" onclick="uploadResult()">Upload Result</button>
            <button type="button" class="btn btn-danger ms-2" onclick="exitAdmin()">Exit Admin Mode</button>
          </div>
        </div>
      </form>

      <!-- Admin Results Review Section -->
      <div class="admin-results-section">
        <h3>Review Uploaded Results</h3>
        <div class="search-container">
          <label for="adminSearch" class="form-label">Search by Competition Item:</label>
          <input type="text" class="form-control" id="adminSearch" placeholder="Enter competition item name">
        </div>
        <div id="adminResultsContainer">
          <div class="stream-group" data-stream="Shareea">
            <h4>Shareea</h4>
            <div class="stream-results"></div>
          </div>
          <div class="stream-group" data-stream="SHE">
            <h4>SHE</h4>
            <div class="stream-results"></div>
          </div>
          <div class="stream-group" data-stream="SHE Plus">
            <h4>SHE Plus</h4>
            <div class="stream-results"></div>
          </div>
          <div class="stream-group" data-stream="Shareea Plus">
            <h4>Shareea Plus</h4>
            <div class="stream-results"></div>
          </div>
          <div class="stream-group" data-stream="Life">
            <h4>Life</h4>
            <div class="stream-results"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Admin PIN Modal -->
  <div class="modal fade" id="adminModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Admin Access</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <label for="adminPin" class="form-label">Enter PIN (up to 8 characters):</label>
          <input type="password" class="form-control" id="adminPin" maxlength="8" placeholder="Enter PIN">
          <div class="invalid-feedback" id="pinError" style="display: none;"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="checkPin()">Enter Admin Mode</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Deletion</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this result? This action cannot be undone.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery, Bootstrap, XLSX JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
    // Initialize results array and excel files from localStorage or create empty
    let results = JSON.parse(localStorage.getItem('competitionResults')) || [];
    let savedExcelFiles = JSON.parse(localStorage.getItem('excelFiles')) || [];
    const adminPin = "Admin123";
    const excelUpdatePin = "Excel456";
    let resultToDelete = null;
    let searchQuery = '';
    const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
    const adminModal = new bootstrap.Modal(document.getElementById('adminModal'));
    let uidMap = {};

    // Sanitize results on load to ensure all required arrays exist and isAllowed field
    function sanitizeResults() {
      results = results.map(result => ({
        ...result,
        firstUids: Array.isArray(result.firstUids) ? result.firstUids : [],
        firstNames: Array.isArray(result.firstNames) ? result.firstNames : [],
        firstColleges: Array.isArray(result.firstColleges) ? result.firstColleges : [],
        firstGrades: Array.isArray(result.firstGrades) ? result.firstGrades : [],
        secondUids: Array.isArray(result.secondUids) ? result.secondUids : [],
        secondNames: Array.isArray(result.secondNames) ? result.secondNames : [],
        secondColleges: Array.isArray(result.secondColleges) ? result.secondColleges : [],
        secondGrades: Array.isArray(result.secondGrades) ? result.secondGrades : [],
        thirdUids: Array.isArray(result.thirdUids) ? result.thirdUids : [],
        thirdNames: Array.isArray(result.thirdNames) ? result.thirdNames : [],
        thirdColleges: Array.isArray(result.thirdColleges) ? result.thirdColleges : [],
        thirdGrades: Array.isArray(result.thirdGrades) ? result.thirdGrades : [],
        entryType: result.entryType || 'individual',
        category: result.category || '',
        isAllowed: result.isAllowed !== undefined ? result.isAllowed : false
      }));
      saveResults();
    }

    $(document).ready(function() {
      // Sanitize existing results
      sanitizeResults();
      // Hide category field and update section initially
      $('#categoryField').hide();
      $('#fCategory').parent().hide();
      $('#noResultsAlert').hide();
      $('#updateExcelSection').hide();
      // Populate competition items dropdown for users
      updateCompetitionItems();
      // Initialize file input listeners
      setupFileInputs();
      // Initialize dynamic input listeners
      setupDynamicInputs();
      // Update winner group labels based on entry type
      updateWinnerLabels();
      // Setup search input listener
      $('#adminSearch').on('input', function() {
        searchQuery = $(this).val().trim().toLowerCase();
        displayAdminResults();
      });
    });

    function checkPin() {
      const pin = $('#adminPin').val();
      if (pin === adminPin) {
        $('#adminSection').show();
        $('#pinError').text('').hide();
        $('#adminPin').removeClass('is-invalid');
        $('#updateExcelSection').show();
        adminModal.hide();
        // Load saved Excel files and display admin results
        loadSavedExcelFiles();
        displayAdminResults();
      } else {
        $('#pinError').text('Incorrect PIN. Please try again.').show();
        $('#adminPin').addClass('is-invalid');
      }
    }

    function loadSavedExcelFiles() {
      uidMap = {};
      if (savedExcelFiles.length === 0) {
        showAlert('No saved Excel files found. Please upload files.', 'info');
        return;
      }

      let processedFiles = 0;
      savedExcelFiles.forEach(base64 => {
        try {
          // Convert base64 to Uint8Array
          const binary = atob(base64);
          const len = binary.length;
          const bytes = new Uint8Array(len);
          for (let i = 0; i < len; i++) {
            bytes[i] = binary.charCodeAt(i);
          }
          // Parse Excel file
          const workbook = XLSX.read(bytes, { type: 'array' });
          const sheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[sheetName];
          const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: ['A', 'B', 'C', 'D'], defval: null });
          jsonData.forEach(row => {
            if (row.A && row.C && row.D) {
              uidMap[row.C] = {
                name: row.D,
                college: row.A
              };
            }
          });
          processedFiles++;
          if (processedFiles === savedExcelFiles.length) {
            showAlert(`Loaded ${savedExcelFiles.length} saved Excel file(s)!`, 'success');
            updateExistingResults();
          }
        } catch (e) {
          showAlert('Error loading saved Excel file.', 'danger');
          console.error(e);
        }
      });
    }

    function setupFileInputs() {
      $('#excelFiles').on('change', function(e) {
        const files = e.target.files;
        if (files.length === 0) {
          showAlert('Please select at least one Excel file.', 'warning');
          return;
        }
        if (files.length > 2) {
          showAlert('Please upload no more than two Excel files.', 'warning');
          this.value = '';
          return;
        }

        savedExcelFiles = [];
        uidMap = {};
        let processedFiles = 0;
        Array.from(files).forEach(file => {
          if (!file.name.match(/\.(xlsx|xls)$/)) {
            showAlert('Please upload valid Excel files (.xlsx or .xls).', 'warning');
            processedFiles++;
            return;
          }
          readExcelFile(file, (data, base64) => {
            data.forEach(row => {
              if (row.A && row.C && row.D) {
                uidMap[row.C] = {
                  name: row.D,
                  college: row.A
                };
              }
            });
            savedExcelFiles.push(base64);
            processedFiles++;
            if (processedFiles === files.length) {
              try {
                localStorage.setItem('excelFiles', JSON.stringify(savedExcelFiles));
                showAlert(`Successfully loaded and saved ${files.length} Excel file(s)!`, 'success');
                updateExistingResults();
              } catch (e) {
                showAlert('Error saving Excel files. Storage limit may be exceeded.', 'danger');
                savedExcelFiles = [];
                uidMap = {};
              }
            }
          });
        });
      });
    }

    function readExcelFile(file, callback) {
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          const sheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[sheetName];
          const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: ['A', 'B', 'C', 'D'], defval: null });
          // Convert file to base64
          const base64Reader = new FileReader();
          base64Reader.onload = function(be) {
            const base64 = be.target.result.split(',')[1];
            callback(jsonData, base64);
          };
          base64Reader.readAsDataURL(file);
        } catch (e) {
          showAlert('Error reading Excel file.', 'danger');
          callback([], '');
        }
      };
      reader.onerror = function() {
        showAlert('Error reading Excel file.', 'danger');
        callback([], '');
      };
      reader.readAsArrayBuffer(file);
    }

    function updateExcelFiles() {
      const pin = $('#excelUpdatePin').val();
      if (pin !== excelUpdatePin) {
        $('#excelPinError').text('Incorrect PIN. Please try again.');
        $('#excelUpdatePin').addClass('is-invalid');
        return;
      }

      const files = $('#newExcelFiles')[0].files;
      if (files.length === 0) {
        showAlert('Please select at least one Excel file to update.', 'warning');
        return;
      }
      if (files.length > 2) {
        showAlert('Please upload no more than two Excel files.', 'warning');
        return;
      }

      savedExcelFiles = [];
      uidMap = {};
      let processedFiles = 0;
      Array.from(files).forEach(file => {
        if (!file.name.match(/\.(xlsx|xls)$/)) {
          showAlert('Please upload valid Excel files (.xlsx or .xls).', 'warning');
          processedFiles++;
          return;
        }
        readExcelFile(file, (data, base64) => {
          data.forEach(row => {
            if (row.A && row.C && row.D) {
              uidMap[row.C] = {
                name: row.D,
                college: row.A
              };
            }
          });
          savedExcelFiles.push(base64);
          processedFiles++;
          if (processedFiles === files.length) {
            try {
              localStorage.setItem('excelFiles', JSON.stringify(savedExcelFiles));
              $('#excelUpdatePin').val('').removeClass('is-invalid');
              $('#excelPinError').text('');
              $('#newExcelFiles').val('');
              showAlert(`Successfully updated ${files.length} Excel file(s)!`, 'success');
              updateExistingResults();
            } catch (e) {
              showAlert('Error saving Excel files. Storage limit may be exceeded.', 'danger');
              savedExcelFiles = [];
              uidMap = {};
            }
          }
        });
      });
    }

    function updateExistingResults() {
      results = results.map(result => {
        const updatePosition = (uids, names, colleges, grades) => {
          return uids.map((uid, i) => {
            if (uid && uidMap[uid]) {
              return {
                uid,
                name: uidMap[uid].name,
                college: uidMap[uid].college,
                grade: grades[i] || ''
              };
            }
            return { uid, name: names[i] || '', college: colleges[i] || '', grade: grades[i] || '' };
          });
        };

        const first = updatePosition(result.firstUids, result.firstNames, result.firstColleges, result.firstGrades);
        const second = updatePosition(result.secondUids, result.secondNames, result.secondColleges, result.secondGrades);
        const third = updatePosition(result.thirdUids, result.thirdNames, result.thirdColleges, result.thirdGrades);

        return {
          ...result,
          firstUids: first.map(x => x.uid),
          firstNames: first.map(x => x.name),
          firstColleges: first.map(x => x.college),
          firstGrades: first.map(x => x.grade),
          secondUids: second.map(x => x.uid),
          secondNames: second.map(x => x.name),
          secondColleges: second.map(x => x.college),
          secondGrades: second.map(x => x.grade),
          thirdUids: third.map(x => x.uid),
          thirdNames: third.map(x => x.name),
          thirdColleges: third.map(x => x.college),
          thirdGrades: third.map(x => x.grade)
        };
      });
      saveResults();
      if ($('#resultsContainer').children().length > 0) {
        filterResults();
      }
      displayAdminResults();
    }

    function updateWinnerLabels() {
      const entryType = $('input[name="entryType"]:checked').val();
      const suffix = entryType === 'group' ? ' Group' : '';
      $('#firstPlaceLabel').text(`First Place${suffix}`);
      $('#secondPlaceLabel').text(`Second Place${suffix}`);
      $('#thirdPlaceLabel').text(`Third Place${suffix}`);
    }

    function setupDynamicInputs() {
      $(document).on('click', '.btn-plus', function() {
        const position = $(this).data('position');
        const group = $(`#${position}PlaceGroup`);
        const index = group.find('.winner-input').length;
        const entryType = $('input[name="entryType"]:checked').val();
        
        if (entryType === 'group' && index >= 7) {
          showAlert('Maximum 7 members per group allowed.', 'warning');
          return;
        }
        
        const newInput = $(`
          <div class="winner-input" data-index="${index}">
            <label class="form-label">UID:</label>
            <input type="text" class="form-control uid-input" data-position="${position}" data-index="${index}" placeholder="Enter UID or NIL">
            <div class="invalid-feedback"></div>
            <label class="form-label mt-2">Name:</label>
            <input type="text" class="form-control name-input" data-position="${position}" data-index="${index}" readonly>
            <label class="form-label mt-2">College:</label>
            <input type="text" class="form-control college-input" data-position="${position}" data-index="${index}" readonly>
            <label class="form-label mt-2">Grade:</label>
            <select class="form-select grade-input" data-position="${position}" data-index="${index}">
              <option value="" selected disabled>-- Select Grade --</option>
              <option value="No Grade">No Grade</option>
              <option value="A">A</option>
              <option value="B">B</option>
              <option value="C">C</option>
            </select>
          </div>
        `);
        
        group.find('.btn-group').before(newInput);
        
        if (index === 1) {
          group.find('.btn-group').append(`
            <button type="button" class="btn btn-sm btn-danger btn-minus" data-position="${position}">− Remove Winner</button>
          `);
        }
      });

      $(document).on('click', '.btn-minus', function() {
        const position = $(this).data('position');
        const group = $(`#${position}PlaceGroup`);
        const inputs = group.find('.winner-input');
        if (inputs.length > 1) {
          inputs.last().remove();
          if (inputs.length === 2) {
            group.find('.btn-minus').remove();
          }
        }
      });

      $(document).on('input', '.uid-input', function() {
        const position = $(this).data('position');
        const index = $(this).data('index');
        const uid = $(this).val();
        validateAndFillUid(position, index, uid);
      });

      $(document).on('change', 'input[name="entryType"]', function() {
        updateWinnerLabels();
        toggleCategoryField();
        // Reset winner inputs to one per position to avoid exceeding group limit
        ['first', 'second', 'third'].forEach(position => {
          const group = $(`#${position}PlaceGroup`);
          group.find('.winner-input').slice(1).remove();
          group.find('.btn-minus').remove();
          group.find('.uid-input').val('');
          group.find('.name-input').val('');
          group.find('.college-input').val('');
          group.find('.grade-input').val('');
        });
      });
    }

    function validateAndFillUid(position, index, uid) {
      const uidField = $(`.uid-input[data-position="${position}"][data-index="${index}"]`);
      const nameField = $(`.name-input[data-position="${position}"][data-index="${index}"]`);
      const collegeField = $(`.college-input[data-position="${position}"][data-index="${index}"]`);
      const gradeField = $(`.grade-input[data-position="${position}"][data-index="${index}"]`);
      const errorField = uidField.next('.invalid-feedback');

      if (!uid) {
        nameField.val('');
        collegeField.val('');
        gradeField.val('');
        uidField.removeClass('is-invalid');
        errorField.text('');
        return;
      }

      if (uid.toUpperCase() === 'NIL') {
        nameField.val('');
        collegeField.val('');
        gradeField.val('');
        uidField.removeClass('is-invalid');
        errorField.text('');
        return;
      }

      const data = uidMap[uid];
      if (data) {
        nameField.val(data.name);
        collegeField.val(data.college);
        uidField.removeClass('is-invalid');
        errorField.text('');
      } else {
        nameField.val('');
        collegeField.val('');
        gradeField.val('');
        uidField.addClass('is-invalid');
        errorField.text('Invalid UID. Please check the uploaded Excel files.');
      }
    }

    function toggleCategoryField() {
      const stream = $('#stream').val();
      const entryType = $('input[name="entryType"]:checked').val();
      if (stream === "Shareea" || stream === "SHE") {
        $('#categoryField').show();
        $('#category').prop('required', true).prop('disabled', false);
        if (entryType === "group") {
          $('#category').val('General');
        } else {
          if ($('#category').val() === 'General') {
            $('#category').val('');
          }
        }
      } else {
        $('#categoryField').hide();
        $('#category').prop('required', false).prop('disabled', false).val('');
      }
    }

    function toggleFilterCategoryField() {
      const stream = $('#fStream').val();
      if (stream === "Shareea" || stream === "SHE") {
        $('#fCategory').parent().show();
      } else {
        $('#fCategory').parent().hide();
        $('#fCategory').val('');
      }
    }

    function exitAdmin() {
      $('#adminSection').hide();
      $('#adminPin').val('');
      $('#resultForm')[0].reset();
      $('#categoryField').hide();
      $('#excelFiles').val('');
      $('#newExcelFiles').val('');
      $('#excelUpdatePin').val('');
      $('#updateExcelSection').hide();
      $('#entryIndividual').prop('checked', true);
      $('#category').prop('disabled', false).val('');
      $('#adminSearch').val('');
      searchQuery = '';
      updateWinnerLabels();
      // Reset dynamic inputs
      ['first', 'second', 'third'].forEach(position => {
        const group = $(`#${position}PlaceGroup`);
        group.find('.winner-input').slice(1).remove();
        group.find('.btn-minus').remove();
        group.find('.uid-input').val('');
        group.find('.name-input').val('');
        group.find('.college-input').val('');
        group.find('.grade-input').val('');
      });
      if ($('#resultsContainer').children().length > 0) {
        filterResults();
      }
    }

    function uploadResult() {
      if (!$('#resultForm')[0].checkValidity()) {
        $('#resultForm').addClass('was-validated');
        return;
      }

      const entryType = $('input[name="entryType"]:checked').val();
      const stream = $('#stream').val();
      const resultData = {
        id: Date.now(),
        compItem: $('#compItem').val(),
        stream: stream,
        category: (stream === "Shareea" || stream === "SHE") ? $('#category').val() : '',
        entryType: entryType,
        firstUids: [],
        firstNames: [],
        firstColleges: [],
        firstGrades: [],
        secondUids: [],
        secondNames: [],
        secondColleges: [],
        secondGrades: [],
        thirdUids: [],
        thirdNames: [],
        thirdColleges: [],
        thirdGrades: [],
        timestamp: new Date().toISOString(),
        isAllowed: false // Default to not allowed
      };

      const positions = ['first', 'second', 'third'];
      let isValid = true;
      for (const position of positions) {
        const inputs = $(`#${position}PlaceGroup .winner-input`);
        const seenUids = new Set();
        inputs.each(function() {
          const uidField = $(this).find('.uid-input');
          const nameField = $(this).find('.name-input');
          const collegeField = $(this).find('.college-input');
          const gradeField = $(this).find('.grade-input');
          const errorField = uidField.next('.invalid-feedback');
          const uid = uidField.val().trim();
          const grade = gradeField.val();

          if (!uid) {
            uidField.addClass('is-invalid');
            errorField.text('Please enter a UID or "NIL".');
            isValid = false;
            return false;
          }

          if (!grade && uid.toUpperCase() !== 'NIL') {
            gradeField.addClass('is-invalid');
            isValid = false;
            return false;
          }

          if (uid.toUpperCase() === 'NIL') {
            resultData[`${position}Uids`].push('');
            resultData[`${position}Names`].push('');
            resultData[`${position}Colleges`].push('');
            resultData[`${position}Grades`].push('');
            return;
          }

          if (seenUids.has(uid)) {
            uidField.addClass('is-invalid');
            errorField.text('Duplicate UID in this position.');
            isValid = false;
            return false;
          }

          if (uidMap[uid]) {
            seenUids.add(uid);
            resultData[`${position}Uids`].push(uid);
            resultData[`${position}Names`].push(nameField.val());
            resultData[`${position}Colleges`].push(collegeField.val());
            resultData[`${position}Grades`].push(grade);
          } else {
            uidField.addClass('is-invalid');
            errorField.text('Invalid UID. Please check the uploaded Excel files.');
            isValid = false;
            return false;
          }
        });
      }

      if (!isValid) return;

      results.push(resultData);
      saveResults();
      showAlert('Submission uploaded successfully! Awaiting review for approval.', 'success');
      
      $('#resultForm').removeClass('was-validated')[0].reset();
      $('#categoryField').hide();
      $('#entryIndividual').prop('checked', true);
      $('#category').prop('disabled', false).val('');
      updateWinnerLabels();
      ['first', 'second', 'third'].forEach(position => {
        const group = $(`#${position}PlaceGroup`);
        group.find('.winner-input').slice(1).remove();
        group.find('.btn-minus').remove();
        group.find('.uid-input').val('');
        group.find('.name-input').val('');
        group.find('.college-input').val('');
        group.find('.grade-input').val('');
      });
      
      updateCompetitionItems();
      displayAdminResults();
    }

    function updateCompetitionItems() {
      const compItemSelect = $('#fCompItem');
      compItemSelect.empty();
      compItemSelect.append('<option value="" selected>-- All Items --</option>');
      const uniqueItems = [...new Set(results.filter(r => r.isAllowed).map(r => r.compItem))];
      uniqueItems.forEach(item => {
        compItemSelect.append(`<option value="${item}">${item}</option>`);
      });
    }

    function filterResults() {
      const fCompItem = $('#fCompItem').val();
      const fStream = $('#fStream').val();
      const fCategory = $('#fCategory').val();

      const filtered = results.filter(r =>
        (!fCompItem || r.compItem === fCompItem) &&
        (!fStream || r.stream === fStream) &&
        (!fCategory || r.category === fCategory) &&
        ($('#adminSection').is(':visible') || r.isAllowed)
      );

      const container = $('#resultsContainer');
      container.empty();
      
      if (filtered.length === 0) {
        $('#noResultsAlert').show();
      } else {
        $('#noResultsAlert').hide();
        filtered.forEach(r => {
          // Ensure arrays exist
          const firstNames = Array.isArray(r.firstNames) ? r.firstNames : [];
          const firstUids = Array.isArray(r.firstUids) ? r.firstUids : [];
          const firstColleges = Array.isArray(r.firstColleges) ? r.firstColleges : [];
          const firstGrades = Array.isArray(r.firstGrades) ? r.firstGrades : [];
          const secondNames = Array.isArray(r.secondNames) ? r.secondNames : [];
          const secondUids = Array.isArray(r.secondUids) ? r.secondUids : [];
          const secondColleges = Array.isArray(r.secondColleges) ? r.secondColleges : [];
          const secondGrades = Array.isArray(r.secondGrades) ? r.secondGrades : [];
          const thirdNames = Array.isArray(r.thirdNames) ? r.thirdNames : [];
          const thirdUids = Array.isArray(r.thirdUids) ? r.thirdUids : [];
          const thirdColleges = Array.isArray(r.thirdColleges) ? r.thirdColleges : [];
          const thirdGrades = Array.isArray(r.thirdGrades) ? r.thirdGrades : [];

          const card = $(`
            <div class="result-card animate__animated animate__fadeIn">
              ${$('#adminSection').is(':visible') ? 
                `<button class="btn btn-sm btn-danger position-absolute top-0 end-0 m-2" onclick="confirmDelete(${r.id})">
                  <i class="bi bi-trash"></i>
                </button>` : ''}
              <div class="header">
                <h3>${r.compItem}</h3>
                <div class="stream-cat">
                  ${r.stream}${r.category ? ' • ' + r.category : ''} • ${r.entryType.charAt(0).toUpperCase() + r.entryType.slice(1)}
                </div>
              </div>
              <div class="winners">
                <div class="winner first-place">
                  <div class="position">1<sup>st</sup></div>
                  <div class="details">
                    ${firstNames.map((name, i) => name ? `
                      <div class="name">
                        <i class="fas fa-trophy trophy-icon"></i>${name}
                        ${i === 0 ? '<div class="congrats-banner animate__animated animate__bounceIn">CONGRATULATIONS!</div>' : ''}
                      </div>
                      <div class="college">${firstColleges[i]}</div>
                      <div class="uid">UID: ${firstUids[i]}</div>
                      <div class="grade">Grade: ${firstGrades[i]}</div>
                    ` : '').join('')}
                    ${firstNames.every(name => !name) ? '<div class="name">None</div>' : ''}
                  </div>
                </div>
                <div class="winner second-place">
                  <div class="position">2<sup>nd</sup></div>
                  <div class="details">
                    ${secondNames.map((name, i) => name ? `
                      <div class="name">${name}</div>
                      <div class="college">${secondColleges[i]}</div>
                      <div class="uid">UID: ${secondUids[i]}</div>
                      <div class="grade">Grade: ${secondGrades[i]}</div>
                    ` : '').join('')}
                    ${secondNames.every(name => !name) ? '<div class="name">None</div>' : ''}
                  </div>
                </div>
                <div class="winner third-place">
                  <div class="position">3<sup>rd</sup></div>
                  <div class="details">
                    ${thirdNames.map((name, i) => name ? `
                      <div class="name">${name}</div>
                      <div class="college">${thirdColleges[i]}</div>
                      <div class="uid">UID: ${thirdUids[i]}</div>
                      <div class="grade">Grade: ${thirdGrades[i]}</div>
                    ` : '').join('')}
                    ${thirdNames.every(name => !name) ? '<div class="name">None</div>' : ''}
                  </div>
                </div>
              </div>
            </div>
          `);
          card.css('animation-delay', `${container.children().length * 0.1}s`);
          container.append(card);
        });
      }
    }

    function resetFilters() {
      $('#fCompItem').val('');
      $('#fStream').val('');
      $('#fCategory').val('');
      $('#resultsContainer').empty();
      $('#noResultsAlert').hide();
      $('#fCategory').parent().hide();
    }

    function confirmDelete(id) {
      resultToDelete = id;
      deleteModal.show();
    }

    $('#confirmDelete').click(function() {
      if (resultToDelete) {
        results = results.filter(r => r.id !== resultToDelete);
        saveResults();
        filterResults();
        updateCompetitionItems();
        displayAdminResults();
        deleteModal.hide();
        showAlert('Submission deleted successfully!', 'success');
        resultToDelete = null;
      }
    });

    function saveResults() {
      try {
        localStorage.setItem('competitionResults', JSON.stringify(results));
      } catch (e) {
        showAlert('Error saving results. Storage limit may be exceeded.', 'danger');
      }
    }

    function showAlert(message, type) {
      const alert = $(`<div class="alert alert-${type} alert-dismissible fade show animate__animated animate__fadeIn" role="alert">
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>`);
      $('.container').prepend(alert);
      setTimeout(() => {
        alert.alert('close');
      }, 3000);
    }

    function displayAdminResults() {
      const streams = ['Shareea', 'SHE', 'SHE Plus', 'Shareea Plus', 'Life'];
      streams.forEach(stream => {
        const streamResults = results.filter(r => 
          r.stream === stream && 
          (!searchQuery || r.compItem.toLowerCase().includes(searchQuery))
        );
        const container = $(`.stream-group[data-stream="${stream}"] .stream-results`);
        container.empty();
        
        if (streamResults.length === 0) {
          container.append('<p>No results found for this stream.</p>');
        } else {
          streamResults.forEach(r => {
            const firstNames = Array.isArray(r.firstNames) ? r.firstNames : [];
            const firstUids = Array.isArray(r.firstUids) ? r.firstUids : [];
            const firstColleges = Array.isArray(r.firstColleges) ? r.firstColleges : [];
            const firstGrades = Array.isArray(r.firstGrades) ? r.firstGrades : [];
            const secondNames = Array.isArray(r.secondNames) ? r.secondNames : [];
            const secondUids = Array.isArray(r.secondUids) ? r.secondUids : [];
            const secondColleges = Array.isArray(r.secondColleges) ? r.secondColleges : [];
            const secondGrades = Array.isArray(r.secondGrades) ? r.secondGrades : [];
            const thirdNames = Array.isArray(r.thirdNames) ? r.thirdNames : [];
            const thirdUids = Array.isArray(r.thirdUids) ? r.thirdUids : [];
            const thirdColleges = Array.isArray(r.thirdColleges) ? r.thirdColleges : [];
            const thirdGrades = Array.isArray(r.thirdGrades) ? r.thirdGrades : [];

            const resultItem = $(`
              <div class="admin-result-item">
                <div class="result-header">
                  <div>
                    <strong>${r.compItem}</strong>
                    <div>${r.category ? r.category + ' • ' : ''}${r.entryType.charAt(0).toUpperCase() + r.entryType.slice(1)}</div>
                  </div>
                  <div class="status-controls">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="status-${r.id}" id="allow-${r.id}" value="allow" ${r.isAllowed ? 'checked' : ''}>
                      <label class="form-check-label" for="allow-${r.id}">Allow</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="status-${r.id}" id="deny-${r.id}" value="deny" ${!r.isAllowed ? 'checked' : ''}>
                      <label class="form-check-label" for="deny-${r.id}">Deny</label>
                    </div>
                  </div>
                </div>
                <div class="mt-2">
                  <div><strong>1st Place:</strong> ${firstNames.length > 0 ? firstNames.map((n, i) => `${n} (UID: ${firstUids[i]}, College: ${firstColleges[i]}, Grade: ${firstGrades[i]})`).join(', ') : 'None'}</div>
                  <div><strong>2nd Place:</strong> ${secondNames.length > 0 ? secondNames.map((n, i) => `${n} (UID: ${secondUids[i]}, College: ${secondColleges[i]}, Grade: ${secondGrades[i]})`).join(', ') : 'None'}</div>
                  <div><strong>3rd Place:</strong> ${thirdNames.length > 0 ? thirdNames.map((n, i) => `${n} (UID: ${thirdUids[i]}, College: ${thirdColleges[i]}, Grade: ${thirdGrades[i]})`).join(', ') : 'None'}</div>
                </div>
                <div class="delete-button-container">
                  <button class="btn btn-sm btn-danger" onclick="confirmDelete(${r.id})">
                    <i class="bi bi-trash"></i> Delete
                  </button>
                </div>
              </div>
            `);
            container.append(resultItem);

            // Add event listeners for radio buttons
            resultItem.find(`input[name="status-${r.id}"]`).on('change', function() {
              const isAllowed = $(this).val() === 'allow';
              results = results.map(result => result.id === r.id ? { ...result, isAllowed } : result);
              saveResults();
              updateCompetitionItems();
              showAlert(`Result status updated to ${isAllowed ? 'Allowed' : 'Denied'}.`, 'success');
            });
          });
        }
      });
    }

    $('#stream').change(toggleCategoryField);
    $('#fStream').change(toggleFilterCategoryField);
  </script>
  <!-- Font Awesome for icons -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</body>
</html>
